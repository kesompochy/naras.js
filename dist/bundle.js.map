{"version":3,"file":"bundle.js","mappings":"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","sources":["webpack://NARAS/webpack/universalModuleDefinition","webpack://NARAS/./src/index.ts","webpack://NARAS/./src/loader.ts","webpack://NARAS/./src/master.ts","webpack://NARAS/./src/sound.ts","webpack://NARAS/webpack/bootstrap","webpack://NARAS/webpack/before-startup","webpack://NARAS/webpack/startup","webpack://NARAS/webpack/after-startup"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"NARAS\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"NARAS\"] = factory();\n\telse\n\t\troot[\"NARAS\"] = factory();\n})(self, function() {\nreturn ","\r\nimport Sound from './sound';\r\nimport SoundMaster from './master';\r\n\r\nexport {Sound, SoundMaster};","export default class Loader{\r\n    resources: Map<string, any> = new Map();\r\n    tasks: Array<Promise<unknown>> = [];\r\n    private _loadThen: Function = function(){}\r\n    _cxt: AudioContext;\r\n    constructor(cxt: AudioContext){\r\n        this._cxt = cxt;\r\n    }\r\n\r\n    add(id: string, src: string): Loader{\r\n        const promise = this._promiseLoadingSound(id, src);\r\n        this.tasks.push(promise);\r\n        return this;\r\n    }\r\n    loadAll(): void{\r\n        Promise.all(this.tasks)\r\n            .then(()=>{this._loadThen();});\r\n    }\r\n    loadThen(func: Function){\r\n        this._loadThen = func;\r\n    }\r\n    private _promiseLoadingSound(id: string, src: string): Promise<any>{\r\n        const promise = new Promise((resolve)=>{\r\n            fetch(src).then((res)=>{\r\n                return res.arrayBuffer();\r\n            }).then((data)=>{\r\n                return this._cxt.decodeAudioData(data);\r\n            }).then((buf)=>{\r\n                this.resources.set(id, buf);\r\n                resolve(buf);\r\n            })\r\n        });\r\n\r\n        return promise;\r\n    }\r\n    get(id: string){\r\n        return this.resources.get(id);\r\n    }\r\n}","import Loader from './loader';\r\nimport Sound from './sound';\r\n\r\ndeclare global {\r\n    interface Window {\r\n        webkitAudioContext: any\r\n    }\r\n}\r\n\r\nconst AudioContext = window.AudioContext || window.webkitAudioContext;\r\n\r\nexport default class SoundMaster{\r\n    cxt: AudioContext = new AudioContext();\r\n    private _masterGain: GainNode = this.cxt.createGain();\r\n    private _unlockEvents: string[] = ['click', 'scroll', 'touchstart'];\r\n\r\n    children: Sound[] = [];\r\n\r\n    loader: Loader = new Loader(this.cxt);\r\n    constructor(){\r\n        this._masterGain.connect(this.cxt.destination);\r\n\r\n        for(let i=0, len=this._unlockEvents.length;i<len;i++){\r\n            document.addEventListener(this._unlockEvents[i], this._initContext.bind(this), {once: true});\r\n        }\r\n        this._initContext();\r\n    }\r\n    private _initContext(): void{\r\n        if(this.cxt.state === 'suspended'){\r\n            this.cxt.resume();\r\n        }\r\n        for(let i=0, len=this._unlockEvents.length;i<len;i++){\r\n            document.removeEventListener(this._unlockEvents[i], this._initContext.bind(this));\r\n        }\r\n    }\r\n    addResource(id: string, src: string): SoundMaster{\r\n        this.loader.add(id, src);\r\n        return this;\r\n    }\r\n    loadAll(): void{\r\n        this.loader.loadAll();\r\n    }\r\n    addChild(sound: Sound){\r\n        this.children.push(sound);\r\n        sound.acquireContext(this.cxt);\r\n    }\r\n}","interface IOptions {\r\n    volume: number;\r\n    loop: boolean;\r\n}\r\n\r\nimport SoundMaster from './master';\r\n\r\n//メモ　detune.value は +100で1/12オクターブ上　+1200で1オクターブ上 -1200で1オクターブ下\r\n\r\nexport default class Sound {\r\n    private _buffer: AudioBuffer;\r\n    private _cxt: AudioContext | undefined;\r\n    private _sourceNode: AudioBufferSourceNode | undefined;\r\n    private _gainNode: GainNode | undefined;\r\n    private _playing: boolean = false;\r\n    private _endTimer: NodeJS.Timeout | undefined;\r\n    private _duration: number = 0;\r\n    private _startedTime: number = 0;\r\n    private _playedTime: number = 0;\r\n    private _loop: boolean = false;\r\n    private _volume: number = 1;\r\n    private _pitch: number = 1;\r\n    parent: SoundMaster | undefined;\r\n\r\n    constructor(buf: AudioBuffer, options?: IOptions){\r\n        this._buffer = buf;\r\n        this._duration = buf.duration;\r\n\r\n        this.loop = options?.loop || false;\r\n        this.volume = options?.volume || 1;\r\n    }\r\n\r\n    set buffer(buffer: AudioBuffer){\r\n        this._buffer = buffer;\r\n        this._duration = buffer.duration;\r\n    }\r\n    acquireContext(cxt: AudioContext): void{\r\n        this._cxt = cxt;\r\n\r\n\r\n        this._gainNode = cxt.createGain();\r\n        this._gainNode.connect(this._cxt.destination);\r\n    }\r\n    reStart(): void{\r\n        this.play(this._playedTime);\r\n    }\r\n    start(): void{\r\n        this._playedTime = 0;\r\n        this.play(0);\r\n    }\r\n    play(offset: number = 0): void{\r\n        if(!this._cxt || !this._buffer || !this._gainNode){\r\n            return;\r\n        }\r\n\r\n        const cxt = this._cxt;\r\n\r\n        this._sourceNode = cxt.createBufferSource()!;\r\n        this._sourceNode.buffer = this._buffer;\r\n\r\n        this._sourceNode.loop = this._loop;\r\n        this._sourceNode.playbackRate.value = this._pitch;\r\n        this._gainNode.gain.value = this._volume;\r\n\r\n        const sourceNode = this._sourceNode;\r\n\r\n        sourceNode.connect(this._gainNode);\r\n        sourceNode.start(0, offset);\r\n\r\n        \r\n\r\n        this._sourceNode = sourceNode;\r\n\r\n        this._startedTime = cxt.currentTime;\r\n\r\n        this._playing = true;\r\n        if(!this.loop) {\r\n            if(this._endTimer) this._clearTimer(); \r\n           this._endTimer = setTimeout(this._endThen.bind(this), this._duration*1000/this._pitch);\r\n        }\r\n    }\r\n    stop(): void{\r\n        if(this._playing && this._sourceNode){\r\n            this._sourceNode.stop(0);\r\n            this._sourceNode.disconnect(0);\r\n            this._endThen();\r\n        }\r\n    }\r\n    pause(): void{\r\n        if(this._playing) {\r\n            this._playedTime = (this._playedTime + this._cxt!.currentTime - this._startedTime) % this._duration;\r\n            this._playing = false;\r\n            this._sourceNode!.stop(0);\r\n            this._clearTimer();\r\n        }\r\n    }\r\n    private _clearTimer(): void{\r\n        clearTimeout(this._endTimer!);\r\n        this._endTimer = undefined;\r\n    }\r\n    private _endThen(): void{\r\n        this._playing = false;\r\n        this._playedTime = 0;\r\n        this._sourceNode!.disconnect(0);\r\n    }\r\n    get playing(): boolean{\r\n        return this._playing;\r\n    }\r\n    set loop(flag: boolean){\r\n        this._loop = flag;\r\n        if(this._sourceNode){\r\n            this._sourceNode.loop = flag;\r\n        }\r\n    }\r\n    get loop(): boolean{\r\n        return this._loop;\r\n    }\r\n    set volume(value: number){\r\n        this._volume = value;\r\n        if(this._gainNode){\r\n            this._gainNode.gain.value = value;\r\n        }\r\n    }\r\n    get volume(): number{\r\n        return this._volume;\r\n    }\r\n    set pitch(value: number) {\r\n        this._pitch = value;\r\n    }\r\n    get pitch(): number{\r\n        return this._pitch;\r\n    }\r\n}\r\n\r\n\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(\"./src/index.ts\");\n",""],"names":[],"sourceRoot":""}